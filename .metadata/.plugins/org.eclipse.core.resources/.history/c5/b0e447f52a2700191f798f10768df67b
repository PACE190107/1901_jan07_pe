package com.revature.data;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.revature.models.Employee;
import com.revature.models.Request;
import com.revature.util.ERSConnectionUtil;

import oracle.jdbc.OracleCallableStatement;
import oracle.jdbc.OracleTypes;

public class DataSource {

	private static final DataSource instance = new DataSource();
	private final List<Employee> Employees = new ArrayList<>();
	private final List<Request> Requests = new ArrayList<>();
	
	private DataSource() {
		try (Connection conn = ERSConnectionUtil.getConnection()) {
			String sql = "call GET_ALL_EMP_INFO(?)";
			CallableStatement cs = conn.prepareCall(sql);
			cs.registerOutParameter(1, OracleTypes.CURSOR);
			cs.execute();
			ResultSet rs = ((OracleCallableStatement)cs).getCursor(1);
			List<Employee> empList = new ArrayList<Employee>();
			while (rs.next()) {
				empList.add(new Employee(
						rs.getInt("EMP_ID"),
						rs.getString("EMP_FNAME"),
						rs.getString("EMP_LNAME"),
						rs.getString("EMP_ADDR"),
						rs.getString("EMP_EMAIL"),
						rs.getString("EMP_UNAME"),
						rs.getString("EMP_PASS"),
						rs.getInt("EMP_ISMGR")));
			}
			return empList;
		} catch (SQLException e) {
			log.error("error occured in getallcustomers method");
		}
		return null;
	}
	}
	
}
